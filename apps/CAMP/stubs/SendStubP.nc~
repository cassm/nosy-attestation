#include "CAM.h"
#include "printf.h"

module SendStubP {
    provides interface AMSend;
    uses interface Timer<TMilli>;
}
implementation {
    message_t *msgptr;

    event void Timer.fired() {
	signal sendDone(msgPtr, SUCCESS);
    }

    command error_t send(am_addr_t addr, message_t* msg, uint8_t len) {
	msgPtr = msg;
	printf("SubSend sending message to %d.\n", addr);
	call Timer.startOneShot(1000);
	return SUCCESS;
    }

    command error_t cancel(message_t* msg) {
	return SUCCESS;
    }

    command uint8_t maxPayloadLength() {
	return TOSH_DATA_LENGTH;
    }

    command void* getPayload(message_t* msg, uint8_t len) {
	if (len > TOSH_DATA_LENGTH)
	    return NULL;
	else
	    return msg->data;
    }
}
     
